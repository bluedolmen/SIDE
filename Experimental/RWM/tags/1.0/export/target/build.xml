<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     10 sept. 08 11:05:17                                                        

     Execute update
                   
     bch                                                                
     ====================================================================== -->
<project name="Transmit new version of modeler on server" default="default">
	<property name="ZIPFile.path" value="/tmp/rwm" />
	<property name="modeler.path" value="/home/bchevallereau/rwm" />
	<property name="server.path" value="/data/www/virtuals/b/l/u/bluexml.net/demo/html" />
	<property name="ZIPFile.name" value="${ZIPFile.path}/RWM_Web_modeler.zip" />

	<!-- ================================= 
          target: default              
         ================================= -->
	<target name="default" depends="remove_backup,backup,deploy,deploy_mysql">
		<!-- Restore access_bdd.php -->
		<move tofile="${modeler.path}/RWM Web Modeler/source/common/access_bdd.php">
			<fileset file="${modeler.path}_backup/RWM Web Modeler/source/common/access_bdd.php" />
		</move>
		<chmod dir="${modeler.path}/RWM Web Modeler/source/transformation/out/" perm="777"/>
		<chmod file="${modeler.path}/RWM Web Modeler/source/external-lib/fop-0.95/fop" perm="555"/>
	</target>

	<condition property="backup_exist">
		<available type="dir" file="${modeler.path}_backup" />
	</condition>

	<condition property="modeler_exist">
		<available type="dir" file="${modeler.path}" />
	</condition>

	<target name="remove_backup" if="backup_exist">
		<delete dir="${modeler.path}_backup" />
	</target>

	<target name="backup" if="modeler_exist">
		<mkdir dir="${modeler.path}_backup" />
		<move todir="${modeler.path}_backup">
			<fileset dir="${modeler.path}">
			</fileset>
		</move>
	</target>

	<target name="deploy">
		<mkdir dir="${ZIPFile.path}/deploy" />
		<unzip src="${ZIPFile.name}" dest="${ZIPFile.path}/deploy" />
		<move todir="${modeler.path}">
			<fileset dir="${ZIPFile.path}/deploy/" />
		</move>
		<delete dir="${ZIPFile.path}/deploy" />
	</target>

	<target name="deploy_mysql">
		<sql driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost:3306/rwm" userid="root" password="qolooiniqa" src="${server.path}/rwm/transformation/transformations.sql" print="yes">
			<classpath>
				<pathelement location="${server.path}/rwm/transformation/lib/mysql-connector-java-5.1.6-bin.jar" />
			</classpath>
		</sql>

	</target>

</project>
